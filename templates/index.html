<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Military AI Screening System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .header { 
            text-align: center; 
            margin-bottom: 40px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            border-radius: 10px;
        }
        .header h1 { 
            font-size: 2.5em; 
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ffd89b, #19547b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .header p { 
            font-size: 1.2em; 
            opacity: 0.9;
        }
        .candidate-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px;
        }
        .candidate-card { 
            border: 2px solid #e0e0e0; 
            padding: 25px; 
            border-radius: 12px; 
            cursor: pointer; 
            transition: all 0.3s ease;
            background: white;
        }
        .candidate-card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        .candidate-card.excellent:hover { border-color: #27ae60; }
        .candidate-card.average:hover { border-color: #f39c12; }
        .candidate-card.poor:hover { border-color: #e74c3c; }
        .candidate-card h3 { 
            margin-bottom: 10px; 
            font-size: 1.3em;
        }
        .candidate-card p { 
            color: #666; 
            margin-bottom: 15px;
        }
        .badge { 
            display: inline-block; 
            padding: 5px 12px; 
            border-radius: 20px; 
            font-size: 0.8em; 
            font-weight: bold; 
            margin-bottom: 10px;
        }
        .badge.excellent { background: #d5f4e6; color: #27ae60; }
        .badge.average { background: #fef5e7; color: #f39c12; }
        .badge.poor { background: #fadbd8; color: #e74c3c; }
        .btn { 
            background: #3498db; 
            color: white; 
            padding: 12px 25px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .btn:hover { 
            background: #2980b9; 
            transform: translateY(-2px);
        }
        .result { 
            margin-top: 30px; 
            padding: 25px; 
            border-radius: 12px;
            display: none;
        }
        .result.pass { background: #d5f4e6; border: 2px solid #27ae60; }
        .result.conditional { background: #fef5e7; border: 2px solid #f39c12; }
        .result.fail { background: #fadbd8; border: 2px solid #e74c3c; }
        .result h2 { margin-bottom: 20px; }
        .biomarker-chart { 
            max-width: 400px; 
            margin: 20px auto; 
        }
        .loading { 
            text-align: center; 
            padding: 20px; 
            display: none;
        }
        .role-list { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 10px; 
            margin: 15px 0;
        }
        .role-tag { 
            background: #3498db; 
            color: white; 
            padding: 8px 15px; 
            border-radius: 20px; 
            font-size: 0.9em;
        }
        .role-tag.combat { background: #e74c3c; }
        .role-tag.support { background: #f39c12; }
        .role-tag.medical { background: #9b59b6; }
        .system-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            border-left: 4px solid #3498db;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-online { background: #27ae60; }
        .status-offline { background: #e74c3c; }
        .status-loading { background: #f39c12; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Military AI Pre-Screening System</h1>
            <p>AI-Powered Physical Fitness Assessment for Military Recruitment</p>
            <div style="margin-top: 15px;">
                <span id="status-indicator" class="status-indicator status-loading"></span>
                <span id="status-text">Checking server status...</span>
            </div>
        </div>

        <div class="system-info">
            <h3>üöÄ System Status: <span id="system-status">Checking...</span></h3>
            <p id="system-message">Connecting to AI server...</p>
        </div>

        <h2>üß™ Demonstration Candidates</h2>
        <p style="margin-bottom: 20px; color: #666;">Click on a candidate to screen them using AI analysis</p>
        
        <div class="candidate-grid">
            <div class="candidate-card excellent" onclick="screenCandidate('excellent')">
                <div class="badge excellent">EXPECTED: PASS</div>
                <h3>‚úÖ Candidate A: Elite Performer</h3>
                <p>Excellent movement patterns, high fitness level, optimal biomarkers</p>
                <button class="btn">Screen This Candidate</button>
            </div>
            
            <div class="candidate-card average" onclick="screenCandidate('average')">
                <div class="badge average">EXPECTED: CONDITIONAL</div>
                <h3>‚ö†Ô∏è Candidate B: Average Performer</h3>
                <p>Moderate fitness level, some areas need improvement</p>
                <button class="btn">Screen This Candidate</button>
            </div>
            
            <div class="candidate-card poor" onclick="screenCandidate('poor')">
                <div class="badge poor">EXPECTED: FAIL</div>
                <h3>‚ùå Candidate C: Poor Performer</h3>
                <p>Movement deficiencies detected, requires medical evaluation</p>
                <button class="btn">Screen This Candidate</button>
            </div>
        </div>

        <div class="loading" id="loading">
            <h3>üîÑ AI Analysis in Progress...</h3>
            <p>Analyzing sensor data and extracting biomarkers</p>
        </div>

        <div class="result" id="result">
            <div id="result-content"></div>
        </div>
    </div>

    <script>
        // Server status check
        async function checkServerStatus() {
            try {
                const response = await fetch('/health');
                const data = await response.json();
                
                const statusIndicator = document.getElementById('status-indicator');
                const statusText = document.getElementById('status-text');
                const systemStatus = document.getElementById('system-status');
                const systemMessage = document.getElementById('system-message');
                
                if (data.status === 'healthy') {
                    statusIndicator.className = 'status-indicator status-online';
                    statusText.textContent = 'Server Online - System Ready';
                    systemStatus.textContent = 'OPERATIONAL';
                    systemStatus.style.color = '#27ae60';
                    systemMessage.textContent = 'AI system is ready for screening candidates';
                } else {
                    statusIndicator.className = 'status-indicator status-loading';
                    statusText.textContent = 'Server Initializing - Please wait';
                    systemStatus.textContent = 'INITIALIZING';
                    systemStatus.style.color = '#f39c12';
                    systemMessage.textContent = 'AI components are loading, please wait a moment';
                }
            } catch (error) {
                const statusIndicator = document.getElementById('status-indicator');
                const statusText = document.getElementById('status-text');
                const systemStatus = document.getElementById('system-status');
                const systemMessage = document.getElementById('system-message');
                
                statusIndicator.className = 'status-indicator status-offline';
                statusText.textContent = 'Server Offline';
                systemStatus.textContent = 'OFFLINE';
                systemStatus.style.color = '#e74c3c';
                systemMessage.textContent = 'Unable to connect to AI server. Please refresh the page.';
            }
        }

        // Check server status on page load and every 10 seconds
        window.addEventListener('load', () => {
            checkServerStatus();
            setInterval(checkServerStatus, 10000);
        });
        async function screenCandidate(type) {
    // Show loading
    document.getElementById('loading').style.display = 'block';
    document.getElementById('result').style.display = 'none';

    // Simulate different sensor data patterns
    const demoData = {
        'excellent': Array(561).fill().map(() => (Math.random() - 0.5) * 2),
        'average': Array(561).fill().map(() => (Math.random() - 0.5) * 1.2),
        'poor': Array(561).fill().map(() => (Math.random() - 0.5) * 0.5)
    };

    try {
        const response = await fetch('/predict', {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify({ sensor_data: demoData[type] })
        });

        // Check if response is OK
        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`Server error: ${response.status} - ${errorText}`);
        }

        const result = await response.json();
        
        if (result.success) {
            displayResult(result, type);
        } else {
            throw new Error(result.error || 'Unknown error from server');
        }
    } catch (error) {
        console.error('Error:', error);
        displayError(error.message);
    } finally {
        document.getElementById('loading').style.display = 'none';
    }
}

       

        function displayResult(result, candidateType) {
            const resultDiv = document.getElementById('result');
            const contentDiv = document.getElementById('result-content');
            
            if (result.success) {
                const pred = result.prediction;
                
                // Set result class based on decision
                resultDiv.className = 'result ' + pred.decision.toLowerCase().replace(' ', '-');
                
                // Create biomarker chart
                const biomarkerChart = `
                    <div class="biomarker-chart">
                        <canvas id="biomarkerChart" width="400" height="300"></canvas>
                    </div>
                `;

                // Create role tags
                const roleTags = pred.recommended_roles.map(role => {
                    const roleClass = role.includes('Medical') ? 'medical' : 
                                    ['Infantry', 'Special Forces', 'Combat Engineer'].includes(role) ? 'combat' : 'support';
                    return `<span class="role-tag ${roleClass}">${role}</span>`;
                }).join('');

                contentDiv.innerHTML = `
                    <h2>üìä AI Screening Results</h2>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; align-items: start;">
                        <div>
                            <h3>üéØ Core Assessment</h3>
                            <p><strong>Detected Activity:</strong> ${pred.activity}</p>
                            <p><strong>AI Confidence:</strong> ${(pred.confidence * 100).toFixed(1)}%</p>
                            <p><strong>Decision:</strong> <span style="font-weight: bold; font-size: 1.2em;">${pred.decision}</span></p>
                            <p><strong>Risk Level:</strong> ${pred.risk_level}</p>
                            <p><strong>Reason:</strong> ${pred.reason}</p>
                            
                            <h3 style="margin-top: 20px;">üíº Recommended Roles</h3>
                            <div class="role-list">
                                ${roleTags}
                            </div>
                        </div>
                        
                        <div>
                            <h3>üî¨ Biomarker Analysis</h3>
                            ${biomarkerChart}
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.05); border-radius: 8px;">
                        <h4>üìà Performance Metrics</h4>
                        <p><strong>Performance Score:</strong> ${pred.performance_score}%</p>
                        ${pred.detected_risks && pred.detected_risks.length > 0 ? 
                            `<p><strong>Detected Risks:</strong> ${pred.detected_risks.join(', ')}</p>` : 
                            '<p><strong>Detected Risks:</strong> None</p>'}
                    </div>
                `;

                // Render chart
                setTimeout(() => {
                    const ctx = document.getElementById('biomarkerChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'radar',
                        data: {
                            labels: ['Movement Quality', 'Fatigue Resistance', 'Movement Smoothness', 'Power Output', 'Endurance'],
                            datasets: [{
                                label: 'Biomarker Scores',
                                data: [
                                    pred.confidence * 100,
                                    (1 - (pred.confidence > 0.8 ? 0.05 : 0.15)) * 100,
                                    (pred.confidence * 0.9 + 0.1) * 100,
                                    (pred.confidence * 90) + 10,
                                    (1 - (pred.confidence > 0.8 ? 0.05 : 0.15)) * 80 + 20
                                ],
                                backgroundColor: 'rgba(52, 152, 219, 0.2)',
                                borderColor: 'rgba(52, 152, 219, 1)',
                                borderWidth: 2,
                                pointBackgroundColor: 'rgba(52, 152, 219, 1)'
                            }]
                        },
                        options: {
                            scale: {
                                min: 0,
                                max: 100,
                                ticks: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }, 100);

            } else {
                contentDiv.innerHTML = `
                    <div style="color: #e74c3c; text-align: center; padding: 20px;">
                        <h3>‚ùå Prediction Error</h3>
                        <p>${result.error || 'Failed to get prediction from server'}</p>
                        <p style="font-size: 0.9em; margin-top: 10px;">Please check if all AI components are loaded.</p>
                    </div>
                `;
            }
            
            resultDiv.style.display = 'block';
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function displayError(errorMessage) {
            const contentDiv = document.getElementById('result-content');
            contentDiv.innerHTML = `
                <div style="color: #e74c3c; text-align: center; padding: 20px;">
                    <h3>‚ùå Connection Error</h3>
                    <p>${errorMessage || 'Unable to connect to AI server'}</p>
                    <p style="font-size: 0.9em; margin-top: 10px;">
                        Please check:<br>
                        1. Server is running<br>
                        2. Internet connection<br>
                        3. Refresh the page and try again
                    </p>
                </div>
            `;
            document.getElementById('result').style.display = 'block';
        }
    </script>
</body>
</html>

